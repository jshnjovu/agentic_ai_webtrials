# Story 1.2: Google Places Business Search

## Status
Draft

## Story
**As a** lead generation agent,
**I want** to search Google Places for businesses by location and niche
**so that** I can discover local businesses with comprehensive data

## Acceptance Criteria
1. ✓ Text search functionality with location and category filters
2. ✓ Business data extraction (name, address, phone, website, rating)
3. ✓ Geographic radius search support
4. ✓ Result pagination handling (up to 10 businesses)
5. ✓ Error handling for invalid locations or API failures

## Tasks / Subtasks
- [ ] Task 1: Google Places API Integration Service (AC: 1, 2)
  - [ ] Create Google Places API client service
  - [ ] Implement text search with location and category parameters
  - [ ] Extract business data fields (name, address, phone, website, rating)
- [ ] Task 2: Geographic Search Implementation (AC: 3)
  - [ ] Implement geographic radius search functionality
  - [ ] Add location validation and coordinate handling
  - [ ] Support multiple location formats (city, coordinates, address)
- [ ] Task 3: Pagination and Result Management (AC: 4)
  - [ ] Implement result pagination handling
  - [ ] Limit results to maximum 10 businesses per search
  - [ ] Add result caching for performance optimization
- [ ] Task 4: Error Handling and Validation (AC: 5)
  - [ ] Implement invalid location error handling
  - [ ] Add API failure error handling with retry logic
  - [ ] Create user-friendly error messages for common failures

## Dev Notes

### Previous Story Insights
- API authentication and rate limiting configuration from Story 1.1
- Environment variables for Google Places API key are already configured
- Rate limiting middleware and circuit breaker pattern are in place

### Data Models
- **Business Search Request Model**: Location, category, radius, pagination parameters
- **Business Data Model**: Name, address, phone, website, rating, coordinates
- **Search Response Model**: Paginated results with business data and metadata
[Source: architecture/data-models.md - No specific guidance found in architecture docs]

### API Specifications
- **Google Places Text Search API**: `/maps/api/place/textsearch/json` endpoint
- **Authentication**: API key via query parameter (from Story 1.1)
- **Rate Limiting**: Requests per minute limit (configured in Story 1.1)
- **Response Format**: JSON with business details and pagination tokens
[Source: architecture/external-apis.md - No specific guidance found in architecture docs]

### Component Specifications
- **Search Service**: Python service class extending BaseService pattern
- **API Client**: Centralized API client with proper error handling and retry logic
- **Data Extraction**: Pydantic models for request/response validation
- **Caching**: Vercel KV (Redis) for API response caching
[Source: architecture/tech-stack.md#cache, architecture/coding-standards.md#external-api-integration]

### File Locations
- **API Routes**: `apps/api/src/api/v1/business-search/` for search endpoints
- **Services**: `apps/api/src/services/google_places_service.py` for Google Places integration
- **Models**: `apps/api/src/schemas/` for search request/response models
- **API Client**: `apps/api/src/core/api_client.py` for HTTP client configuration
[Source: architecture/unified-project-structure.md#api]

### Testing Requirements
- **Test Location**: `apps/api/tests/unit/test_services/test_google_places_service.py`
- **Test Framework**: pytest + httpx for API testing
- **Test Coverage**: Unit tests for search service, integration tests for API responses
- **Mocking**: Google Places API responses must be mocked in unit tests
- **Test Data**: Mock business search responses with various data scenarios
[Source: architecture/testing-strategy.md#backend-tests]

### Technical Constraints
- **Python Version**: 3.11+ for backend implementation
- **FastAPI Framework**: 0.104+ for API endpoints
- **External API Integration**: Must include circuit breaker pattern and exponential backoff retry logic
- **Caching**: Use Vercel KV (Redis) for API response caching
- **Error Handling**: All API routes must use standard error handler with proper HTTP status codes
- **Logging**: Use structured logging with consistent format including runId, businessId, and agentName
[Source: architecture/tech-stack.md#backend-language, architecture/coding-standards.md#external-api-integration]

## Testing
- **Test File Location**: `apps/api/tests/unit/test_services/test_google_places_service.py`
- **Test Standards**: Follow pytest patterns with proper mocking of Google Places API responses
- **Testing Frameworks**: pytest + httpx for backend testing
- **Specific Requirements**: 
  - Mock Google Places API responses for unit tests
  - Test search functionality with various location and category combinations
  - Validate data extraction for all business fields
  - Test pagination logic and result limiting
  - Test error handling for invalid locations and API failures
  - Test geographic radius search functionality

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-19 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*This section will be populated by the QA Agent during review*
